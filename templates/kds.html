<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>KDS - Pedidos na Cozinha</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
</head>
<body>
    <div class="container-fluid mt-3">
        <h2 class="text-center mb-4">KDS - Pedidos Pendentes</h2>
        <div id="pedidos" class="row"></div>
    </div>

    <script>
        const socket = io();

        function renderPedido(pedido) {
            return `
                <div class="col-md-4 mb-3" id="pedido-${pedido.id}">
                    <div class="card border-primary">
                        <div class="card-header">
                            <strong>Pedido ID:</strong> ${pedido.pedido_id}
                        </div>
                        <div class="card-body">
                            <p><strong>Cliente:</strong> ${pedido.cliente}</p>
                            <p><strong>Item:</strong> ${pedido.item}</p>
                            <p><strong>Quantidade:</strong> ${pedido.quantidade}</p>
                            <p><strong>Total:</strong> R$ ${pedido.total_liquido}</p>
                            <button class="btn btn-success btn-block" onclick="marcarPronto(${pedido.id})">Marcar como pronto</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function marcarPronto(id) {
            fetch(`/pedido/${id}/pronto`, { method: "POST" }).then(() => {
                document.getElementById(`pedido-${id}`).remove();
            });
        }

        function carregarPedidos() {
            fetch("/api/pedidos")
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById("pedidos");
                    container.innerHTML = "";
                    data.forEach(p => container.innerHTML += renderPedido(p));
                });
        }

        socket.on("novo_pedido", () => {
            carregarPedidos();
        });

        // Inicial
        carregarPedidos();
    </script>
</body>
</html>

